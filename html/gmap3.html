<!DOCTYPE html>
<html>
<body>

<div id="map" style="width:100%;height:500px;"></div>

<script>
var markers = [];
function myMap() {
  var mapCanvas = document.getElementById("map");
  var myCenter=new google.maps.LatLng(25.04674, 121.52168);
  var mapOptions = {center: myCenter, zoom: 14};
  var map = new google.maps.Map(mapCanvas, mapOptions);
  google.maps.event.addListener(map, 'click', function(event) {
    placeMarker(map, event.latLng);
  });
}

function placeMarker(map, location) {
  var myMarkers = map.markers;
  for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(null);
        }
  var geocoder = new google.maps.Geocoder();
  var  popup = new google.maps.InfoWindow();
  var marker = new google.maps.Marker({
    position: location,
    map: map
  });
  markers.push(marker);
  
  var markerPosition = marker.getPosition();

  // 將經緯度透過 Google map API 反查地址
   geocoder.geocode({'latLng': markerPosition}, function(results, status) {
	    if (status == google.maps.GeocoderStatus.OK) {
	       if (results) {
	                    showAddressOfResult(results[0], marker,map , popup);
	       }
	    } else {
	       alert("Reverse Geocoding failed because: " + status );
	    }
	  });
}


// 設定 marker 的訊息泡泡
function showAddressOfResult(result, marker ,map , popup ) {
	map.setCenter(marker.getPosition());
    var LatLng = marker.getPosition();
	var popupContent = '<b>地址: </b> ' + result.formatted_address +"<br/><b>緯度：</b>" + LatLng.lat() + "<br/><b>經度：</b>" + LatLng.lng() ;
	popup.setContent(popupContent);
	popup.open(map, marker);
};

	   

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBu-916DdpKAjTmJNIgngS6HL_kDIKU0aU&callback=myMap"></script>
<!--
To use this code on your website, get a free API key from Google.
Read more at: https://www.w3schools.com/graphics/google_maps_basic.asp
-->

</body>
</html>

